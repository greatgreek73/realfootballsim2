# Matches Frontend Integration Plan

> Шаг 2 из дорожной карты интеграции матчей: структурирование пользовательских потоков и схемы UI.

## 1. Основные пользовательские сценарии

1. **Обзор матчей**  
   - Пользователь открывает `/matches`.  
   - Видит ближайшие и прошедшие матчи своего клуба, переключает страницы.  
   - Фильтрует по статусу (в разработке), переходит на карточку матча.

2. **Карточка матча**  
   - `/matches/:id` показывает составы, счёт, события, вкладки «События», «Статистика», «Составы».  
   - Из карточки можно перейти в live-режим, запустить симуляцию, открыть историю событий.

3. **Live / Симуляция**  
   - Экран `/matches/:id/live` отображает текущую минуту, лог событий, ключевые метрики.  
   - Доступны действия: «Продолжить минуту», «Замена», «Изменить тактику» (UI-слой, вызывает соответствующие POST).  
   - По завершении возвращает на карточку матча.

4. **Создание/редактирование матча**  
   - `/matches/create` или модальное окно.  
   - Поля: команды, дата/время, флаги «дружеский/чемпионат», привязка к чемпионату, включение нарратива.  
   - Валидация полей, по сохранению редирект на карточку.

5. **Турнирный календарь**  
   - `/tournaments/:id/calendar` (будет реюзить компоненты матчей).  
   - Грид календаря со ссылками на матчи, быстрый просмотр результатов.

## 2. Структура UI и компоненты

### 2.1 MatchesListPage (`/matches`)

- **Компоненты**: `MatchesTable`, `MatchesFilters`, `MatchesPaginationSummary`.  
- **API**: `fetchMatches({ clubId?, status?, processed?, page, pageSize })`.  
- **Состояния**: `loading`, `error`, `items`, `meta`.  
- **Расширения** (дальше): сохранение фильтров в URL (`?status=in_progress`), быстрые клики на название команды.

### 2.2 MatchDetailPage (`/matches/:id`)

- Хэдер с названием команд, статусом, действиями.  
- Вкладки: `EventsTab`, `StatsTab`, `LineupsTab`, `NarrativeTab`.  
- **API**: `fetchMatch(id)`, `fetchMatchEvents(id)`, `fetchMatchStats(id)`; POST `simulateMatch`, `substitutePlayer`.  
- Использовать React Suspense/Lazy для вкладок, кэшировать данные между переключениями.

### 2.3 LiveMatchPage (`/matches/:id/live`)

- Структура в три колонки: поле, лента событий, панель действий.  
- Live-обновления: опрашивать `/match_events_json` каждые N секунд или через WebSocket (фаза 2).  
- Управление матчем: кнопки POST `/simulate`, `/substitute`, `/tactic`.  
- Состояния ошибок (например, матч уже завершён).

### 2.4 MatchForm (create/edit)

- Форма MUI `Stepper` или стандартная колонка с карточками.  
- Выпадающие списки команд (таска: подготовить API).  
- Подтверждение перед удалением/отменой.

## 3. Навигация и роуты

| Route                         | Компонент              | Назначение                              |
|------------------------------|------------------------|-----------------------------------------|
| `/matches`                   | `MatchesPage`          | Список всех матчей                      |
| `/matches/:id`               | `MatchDetailPage`      | Карточка матча                          |
| `/matches/:id/live`          | `MatchLivePage`        | Live-события и управление                |
| `/matches/create`            | `MatchFormPage`        | Создание матча                          |
| `/matches/:id/edit`          | `MatchFormPage`        | Редактирование матча                    |
| `/tournaments/:id/calendar`* | `ChampionshipCalendar` | Календарь чемпионата (позже)            |

\* будет внедрено при переносе турнирного модуля.

Меню: основной пункт «Matches» (уже добавлен), в будущем — подменю «Live», «Create Match» при необходимости.

## 4. API-потребности

| Endpoint                             | Статус | Комментарий |
|--------------------------------------|--------|-------------|
| `GET /api/matches/`                  | готов  | Пагинация, фильтры (уже реализовано) |
| `GET /api/matches/<id>/`             | нужно  | Подробная информация (lineups, статус) |
| `GET /api/matches/<id>/events/`      | есть?  | Использовать `match_events_json`, возможно переименовать |
| `POST /api/matches/<id>/simulate/`   | нужно  | Обёртка над `simulate_match_view` |
| `POST /api/matches/<id>/substitute/` | есть   | уже доступен (`substitute_player`) |
| `POST /api/matches/`                 | нужно  | Создание матчей |
| `PATCH /api/matches/<id>/`           | нужно  | Базовое редактирование |

Предлагается вынести новые JSON-view в `matches/api_views.py` и подключить в `urls.py`.

## 5. Состояния и управление данными

- Рассмотреть использование React Query для кеширования матчей и live-данных.  
- Для начального шага — локальное состояние + перезапрос по действиям.  
- Обработать edge cases: матч без даты, матч без чемпионата, неожиданный статус (`error`).

## 6. UI/UX заметки

- Дать пользователю быстрый доступ к ближайшему матчу на странице «My Club» (widget → `/matches/:id`).  
- Карточка матча: показывать баннеры команд, иконки статуса (например, «LIVE»).  
- Live режим: sticky-бар с текущим счётом, таймером, кнопкой паузы.  
- Отображение нарратива (если доступно) — отдельная вкладка или боковая панель.

## 7. Обновление задач (backlog)

1. Реализовать `GET /api/matches/<id>/` (backend).  
2. Создать `MatchDetailPage` (frontend) + маршруты.  
3. Подготовить Live-компоненты и API вызовы симуляции.  
4. Импортировать матч-формы (`create_match.html`) в SPA.  
5. Интегрировать календарь чемпионатов, когда будет готов турнирный модуль.

---

Документ фиксирует архитектурное видение и служит ориентиром для последующих шагов разработки фронтенда матчей.
