# Markov Engine v0 — Match Simulation Spec (MVP)

**Цель:** простой, детерминируемый симулятор на цепях Маркова с фиксированным тиком Δt=10с (6 тиков/мин), 90 минут основного времени, без добавленного времени (пока).

## Состояния (узлы)
- `KICKOFF` — ввод мяча с центра (старт тайма/после гола).
- `OPEN_PLAY_DEF` / `OPEN_PLAY_MID` / `OPEN_PLAY_FINAL` — открытая игра по зонам.
- `SHOT` — удар (исход: гол/мимо/сейв/в угловой).
- `OUT` — мяч вне игры (аут/угловой/удар от ворот).
- `FOUL` — фол/стоп-игра (штрафной/свободный, без пенальти в MVP).
- `GK` — вратарь/удар от ворот, розыгрыш в DEF.

## Время
- Δt = **10 секунд** на один переход: 6 переходов на «реальную» минуту.
- Обновление фронта — **минутными сводками**; владения через границы минут **не обрываем**.

## Перезапуски (правила)
- `SHOT:goal` → `KICKOFF` соперника.
- `SHOT:saved` / `off_target` → `GK` соперника.
- `SHOT:deflected_corner` → `OUT:corner` в `FINAL` для бьющей стороны.
- `OUT`:
  - `FINAL`: угловой/аут атакующей, либо `GK` соперника.
  - `MID`: аут той же стороны.
  - `DEF`: аут той же стороны, редкий угловой сопернику.
- `FOUL` → возобновление в соответствующей зоне (MID/FINAL/DEF) у пострадавшей стороны.
- `GK` → розыгрыш в `OPEN_PLAY_DEF` своей команды.

## Нейтральные базовые вероятности (v0)
- Заданы в `matches/engines/markov_spec_v0.yaml`.
- Суммы вероятностей по каждому узлу = **1.0** (с допуском на округление).

## Контекст (позже)
- Счёт, минута, удаление, усталость, стиль — **не** входят в состояние, а будут **модификаторами** вероятностей (неоднородная цепь).

## Инварианты
1) Матч всегда завершается (90 минут, позже — добавленное время).
2) После `SHOT:goal` — всегда `KICKOFF`.
3) Из `OUT/FOUL/GK` — только допустимые переходы (по правилам выше).
4) На каждом шаге есть ненулевая вероятность «закрыть владение», чтобы не зациклиться.

## Калибровка (цели на будущее)
- Удары: ~20–28 на матч суммарно, Голы: ~1.6–3.0, Владение: 45–55±.
- Корректировать: долю входов в FINAL и вероятность `SHOT` из FINAL.

