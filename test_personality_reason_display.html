<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Personality Reason Display</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .events-box {
            max-height: 600px;
            overflow-y: auto;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
        }
        
        .list-group-item {
            transition: all 0.3s ease;
            margin-bottom: 5px;
        }
        
        .new-event {
            opacity: 0;
            transform: translateX(-20px);
        }
        
        .new-event-visible {
            opacity: 1;
            transform: translateX(0);
        }
        
        .event-icon {
            font-size: 1.2em;
            margin: 0 5px;
        }
        
        .personality-reason {
            padding-left: 30px;
            color: #6c757d;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1>Test Personality Reason Display</h1>
        <hr>
        
        <div class="row">
            <div class="col-md-8">
                <h3>–°–æ–±—ã—Ç–∏—è –º–∞—Ç—á–∞</h3>
                <div id="originalEvents">
                    <div class="events-box">
                        <!-- –ü—Ä–∏–º–µ—Ä—ã —Å–æ–±—ã—Ç–∏–π —Å personality_reason -->
                        <div class="list-group-item">
                            <strong>85'</strong> <span class="event-icon">‚öΩ</span> –ì–æ–ª! –û—Ç–ª–∏—á–Ω—ã–π —É–¥–∞—Ä –æ—Ç –†–æ–Ω–∞–ª–¥—É
                            <small class="text-muted">(–†–æ–Ω–∞–ª–¥—É)</small>
                            <div class="personality-reason mt-1">
                                <small class="text-secondary fst-italic">(Competitive Nature: —Ä–µ—à–∏–ª –≤–∑—è—Ç—å –∏–≥—Ä—É –Ω–∞ —Å–µ–±—è –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –º–æ–º–µ–Ω—Ç)</small>
                            </div>
                        </div>
                        
                        <div class="list-group-item">
                            <strong>82'</strong> <span class="event-icon">‚û°Ô∏è</span> –¢–æ—á–Ω—ã–π –ø–∞—Å –æ—Ç –ú–µ—Å—Å–∏ –∫ –°—É–∞—Ä–µ—Å—É
                            <small class="text-muted">(–ú–µ—Å—Å–∏ ‚Üí –°—É–∞—Ä–µ—Å)</small>
                            <div class="personality-reason mt-1">
                                <small class="text-secondary fst-italic">(Team Player: –ø—Ä–µ–¥–ø–æ—á–µ–ª –æ—Ç–¥–∞—Ç—å –ø–∞—Å –ø–∞—Ä—Ç–Ω–µ—Ä—É –≤–º–µ—Å—Ç–æ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è)</small>
                            </div>
                        </div>
                        
                        <div class="list-group-item">
                            <strong>78'</strong> <span class="event-icon">‚ö†Ô∏è</span> –§–æ–ª! –ì—Ä—É–±–∞—è –∏–≥—Ä–∞ –æ—Ç –†–∞–º–æ—Å–∞
                            <small class="text-muted">(–†–∞–º–æ—Å)</small>
                            <div class="personality-reason mt-1">
                                <small class="text-secondary fst-italic">(Aggressive: —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω–∞—è –∂–µ—Å—Ç–∫–∞—è –∏–≥—Ä–∞ –≤ –æ–±–æ—Ä–æ–Ω–µ)</small>
                            </div>
                        </div>
                        
                        <div class="list-group-item">
                            <strong>75'</strong> <span class="event-icon">‚ùå</span> –ü—Ä–æ–º–∞—Ö! –ù–µ—Ç–æ—á–Ω—ã–π —É–¥–∞—Ä –æ—Ç –ú–±–∞–ø–ø–µ
                            <small class="text-muted">(–ú–±–∞–ø–ø–µ)</small>
                            <div class="personality-reason mt-1">
                                <small class="text-secondary fst-italic">(Risk Taker: –ø–æ–ø—ã—Ç–∫–∞ —Å–ª–æ–∂–Ω–æ–≥–æ —É–¥–∞—Ä–∞ —Å –æ—Å—Ç—Ä–æ–≥–æ —É–≥–ª–∞)</small>
                            </div>
                        </div>
                        
                        <!-- –ü—Ä–∏–º–µ—Ä —Å–æ–±—ã—Ç–∏—è –±–µ–∑ personality_reason -->
                        <div class="list-group-item">
                            <strong>72'</strong> <span class="event-icon">‚û°Ô∏è</span> –û–±—ã—á–Ω—ã–π –ø–∞—Å –≤ —Ü–µ–Ω—Ç—Ä–µ –ø–æ–ª—è
                            <small class="text-muted">(–ë—É—Å–∫–µ—Ç—Å ‚Üí –•–∞–≤–∏)</small>
                        </div>
                    </div>
                </div>
                
                <div class="mt-3">
                    <button class="btn btn-primary" onclick="addTestEvent()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ</button>
                </div>
            </div>
            
            <div class="col-md-4">
                <h3>–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <div id="debug-info" class="bg-light p-3">
                    <pre id="debug-output">–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π...</pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –≠–º—É–ª—è—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è –∫–∞–∫ –≤ live_match.js
        function addEventToList(evt) {
            const eventsBox = document.querySelector('.events-box');
            
            // DEBUG: –õ–æ–≥–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
            console.log('=== DEBUG: addEventToList ===');
            console.log('Event received:', evt);
            console.log('Event type:', evt.event_type);
            console.log('Personality reason:', evt.personality_reason);
            console.log('===========================');
            
            updateDebugInfo(evt);

            const item = document.createElement('div');
            item.className = 'list-group-item new-event';

            // –ò–∫–æ–Ω–∫–∞ —Å–æ–±—ã—Ç–∏—è
            const iconMap = {
                goal: '‚öΩ', counterattack: '‚ö°', interception: 'üîÑ',
                shot_miss: '‚ùå', pass: '‚û°Ô∏è', foul: '‚ö†Ô∏è', injury_concern: '‚úö'
            };
            const icon = iconMap[evt.event_type] || 'M';

            // –§–æ—Ä–º–∏—Ä—É–µ–º HTML —Å–æ–±—ã—Ç–∏—è
            let html = `<strong>${evt.minute}'</strong> <span class="event-icon">${icon}</span> ${evt.description}`;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–≥—Ä–æ–∫–∞—Ö
            if (evt.player_name) {
                html += ` <small class="text-muted">(${evt.player_name}`;
                if (evt.related_player_name) {
                    html += ` ‚Üí ${evt.related_player_name}`;
                }
                html += `)</small>`;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–ª–∏—è–Ω–∏–∏ —á–µ—Ä—Ç—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞
            if (evt.personality_reason) {
                console.log('DEBUG: Adding personality_reason to HTML:', evt.personality_reason);
                html += `<div class="personality-reason mt-1"><small class="text-secondary fst-italic">(${evt.personality_reason})</small></div>`;
            } else {
                console.log('DEBUG: No personality_reason found in event');
            }

            item.innerHTML = html;

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ —Å–ø–∏—Å–∫–∞ –∏ –∞–Ω–∏–º–∏—Ä—É–µ–º
            eventsBox.insertBefore(item, eventsBox.firstChild);
            requestAnimationFrame(() => {
                item.classList.add('new-event-visible');
            });
        }
        
        function updateDebugInfo(evt) {
            const debugOutput = document.getElementById('debug-output');
            debugOutput.textContent = JSON.stringify(evt, null, 2);
        }
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
        const testEvents = [
            {
                minute: 90,
                event_type: 'goal',
                description: '–ì–û–û–û–õ! –ù–µ–≤–µ—Ä–æ—è—Ç–Ω—ã–π —É–¥–∞—Ä –≤ –¥–µ–≤—è—Ç–∫—É!',
                personality_reason: 'Clutch Player: –∑–∞–±–∏–≤–∞–µ—Ç –≤–∞–∂–Ω—ã–µ –≥–æ–ª—ã –≤ –∫–æ–Ω—Ü–æ–≤–∫–∞—Ö –º–∞—Ç—á–µ–π',
                player_name: '–ò–≥—Ä–æ–∫ –ê'
            },
            {
                minute: 88,
                event_type: 'pass',
                description: '–û–ø–∞—Å–Ω—ã–π –ø—Ä–æ–Ω–∏–∫–∞—é—â–∏–π –ø–∞—Å',
                personality_reason: 'Creative: –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤ –∞—Ç–∞–∫–µ',
                player_name: '–ò–≥—Ä–æ–∫ –ë',
                related_player_name: '–ò–≥—Ä–æ–∫ –í'
            },
            {
                minute: 86,
                event_type: 'interception',
                description: '–í–∞–∂–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç –≤ —Ü–µ–Ω—Ç—Ä–µ –ø–æ–ª—è',
                personality_reason: null, // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—ã—Ç–∏—è –±–µ–∑ personality_reason
                player_name: '–ò–≥—Ä–æ–∫ –ì'
            }
        ];
        
        let eventIndex = 0;
        
        function addTestEvent() {
            if (eventIndex < testEvents.length) {
                addEventToList(testEvents[eventIndex]);
                eventIndex++;
            } else {
                alert('–í—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–æ–±–∞–≤–ª–µ–Ω—ã');
            }
        }
        
        // –≠–º—É–ª—è—Ü–∏—è WebSocket —Å–æ–æ–±—â–µ–Ω–∏—è
        function simulateWebSocketMessage() {
            const wsData = {
                type: 'match_update',
                data: {
                    minute: 91,
                    events: [{
                        minute: 91,
                        event_type: 'goal',
                        description: '–ü–æ–±–µ–¥–Ω—ã–π –≥–æ–ª –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–∏–Ω—É—Ç–µ!',
                        personality_reason: 'Mental Strength: –Ω–µ —Å–¥–∞–µ—Ç—Å—è –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–≤–∏—Å—Ç–∫–∞',
                        player_name: '–¢–µ—Å—Ç–æ–≤—ã–π –ò–≥—Ä–æ–∫'
                    }],
                    partial_update: true
                }
            };
            
            console.log('=== DEBUG: WebSocket Events ===');
            console.log('Number of events:', wsData.data.events.length);
            wsData.data.events.forEach((evt, idx) => {
                console.log(`Event ${idx}:`, evt);
                if (evt.personality_reason) {
                    console.log(`Event ${idx} has personality_reason:`, evt.personality_reason);
                }
            });
            console.log('==============================');
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è
            if (wsData.data.events && wsData.data.events.length > 0) {
                wsData.data.events.forEach(evt => addEventToList(evt));
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ WebSocket —ç–º—É–ª—è—Ü–∏—é...');
            simulateWebSocketMessage();
        }, 2000);
    </script>
</body>
</html>