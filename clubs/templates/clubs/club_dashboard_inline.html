{% extends 'core/base.html' %}
{% load static %}

{% block title %}{{ club.name }} - Dashboard{% endblock %}

{% block extra_css %}
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Manrope:wght@700;800&display=swap" rel="stylesheet">

<!-- Inline Dashboard Styles for debugging -->
<style>
/* Design Tokens */
:root {
    --color-primary: #2D7A7B;
    --color-primary-light: #3A9899;
    --color-primary-dark: #1F5657;
    --color-primary-subtle: #E8F3F3;
    --color-background: #FFFFFF;
    --color-surface: #FAFBFC;
    --color-border: #E8ECEF;
    --color-text-primary: #1A202C;
    --color-text-secondary: #64748B;
    --color-text-muted: #94A3B8;
    --color-success: #10B981;
    --color-warning: #F59E0B;
    --color-error: #EF4444;
    --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    --font-display: 'Manrope', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    --space-1: 0.25rem;
    --space-2: 0.5rem;
    --space-3: 0.75rem;
    --space-4: 1rem;
    --space-5: 1.25rem;
    --space-6: 1.5rem;
    --space-8: 2rem;
    --radius-sm: 0.375rem;
    --radius-md: 0.5rem;
    --radius-lg: 0.75rem;
    --radius-full: 9999px;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --transition-fast: 150ms ease;
    --transition-base: 200ms ease;
}

/* Dashboard Container */
.dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: var(--space-8) var(--space-6);
    background-color: var(--color-background);
}

/* Dashboard Grid - The main grid layout */
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: var(--space-6);
}

/* Widget Base Styles */
.widget {
    background-color: var(--color-surface);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    transition: all var(--transition-base);
    overflow: hidden;
}

.widget:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
}

.widget-header {
    padding: var(--space-5) var(--space-6);
    border-bottom: 1px solid var(--color-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.widget-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0;
}

.widget-body {
    padding: var(--space-6);
}

/* Next Match Widget spans 2 columns */
.widget-next-match {
    grid-column: span 2;
}

/* Status Grid */
.status-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-5);
}

/* Responsive */
@media (max-width: 768px) {
    .dashboard-grid {
        grid-template-columns: 1fr;
    }
    
    .widget-next-match {
        grid-column: span 1;
    }
}
</style>

<!-- Also try to load external CSS -->
<link rel="stylesheet" href="{% static 'clubs/css/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Test message -->
    <div style="background: #e8f3f3; padding: 1rem; margin-bottom: 2rem; border-radius: 0.5rem;">
        <p style="margin: 0; color: #2D7A7B;">
            <strong>Debug Mode:</strong> This page is using inline styles. The dashboard grid should be visible below.
        </p>
    </div>

    <!-- Header Section -->
    <header class="dashboard-header">
        <div class="header-content">
            <div class="club-identity">
                <h1 class="h2">{{ club.name }}</h1>
                <p class="body-sm">{{ club.league.name }} â€¢ Division {{ club.league.level }}</p>
            </div>
            <div class="header-actions">
                <a href="{% url 'clubs:team_selection' club.id %}" class="btn btn-primary">
                    Team Selection
                </a>
                <a href="{% url 'clubs:club_detail' club.id %}" class="btn btn-ghost">
                    Full Details
                </a>
            </div>
        </div>
    </header>

    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
        <!-- Next Match Widget -->
        <div class="widget widget-next-match">
            <div class="widget-header">
                <h3 class="widget-title">Next Match</h3>
                {% if next_match %}
                <span class="widget-badge">
                    {% if next_match.datetime %}
                        {{ next_match.datetime|date:"M d, H:i" }}
                    {% else %}
                        Scheduled
                    {% endif %}
                </span>
                {% endif %}
            </div>
            <div class="widget-body">
                {% if next_match %}
                    <div class="match-preview">
                        <div class="team-preview">
                            <span class="team-name">{{ next_match.home_team.name }}</span>
                            {% if next_match.home_team == club %}
                                <span class="team-badge home">HOME</span>
                            {% endif %}
                        </div>
                        <div class="vs-separator">VS</div>
                        <div class="team-preview">
                            <span class="team-name">{{ next_match.away_team.name }}</span>
                            {% if next_match.away_team == club %}
                                <span class="team-badge away">AWAY</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="match-actions">
                        <a href="{% url 'matches:match_detail' next_match.id %}" class="btn btn-primary btn-sm">
                            View Match
                        </a>
                        <a href="{% url 'clubs:team_selection' club.id %}" class="btn btn-secondary btn-sm">
                            Prepare Squad
                        </a>
                    </div>
                {% else %}
                    <div class="empty-state">
                        <p class="body-sm">No upcoming matches scheduled</p>
                        <a href="{% url 'matches:simulate_match' 0 %}" class="btn btn-ghost btn-sm">
                            Schedule Friendly
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Team Status Widget -->
        <div class="widget widget-team-status">
            <div class="widget-header">
                <h3 class="widget-title">Team Status</h3>
            </div>
            <div class="widget-body">
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">Total Players</span>
                        <span class="status-value">{{ players_count }}</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Average Age</span>
                        <span class="status-value">{{ average_age|floatformat:1 }}</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Recent Form</span>
                        <div class="form-indicators">
                            {% for result in recent_form %}
                                <span class="form-indicator form-{{ result|lower }}">{{ result }}</span>
                            {% empty %}
                                <span class="status-value">-</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="status-item">
                        <span class="status-label">League Position</span>
                        <span class="status-value">{{ league_position|default:"-" }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Other widgets follow the same pattern... -->
    </div>
</div>
{% endblock %}